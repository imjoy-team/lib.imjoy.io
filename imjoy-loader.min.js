!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("imjoyLoader",[],r):"object"==typeof exports?exports.imjoyLoader=r():e.imjoyLoader=r()}(window,(function(){return function(e){var r={};function o(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=r,o.d=function(e,r,i){o.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,r){if(1&r&&(e=o(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)o.d(i,n,function(r){return e[r]}.bind(null,n));return i},o.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(r,"a",r),r},o.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},o.p="",o(o.s=18)}({13:function(e,r){(function(r){e.exports=r}).call(this,{})},18:function(module,__webpack_exports__,__webpack_require__){"use strict";function _injectScript(e){return new Promise((r,o)=>{const i=document.createElement("script");i.src=e,i.addEventListener("load",r),i.addEventListener("error",()=>{document.head.removeChild(i),o("Error loading script: "+e)}),i.addEventListener("abort",()=>o("Script loading aborted.")),document.head.appendChild(i)})}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"loadImJoyCore",(function(){return loadImJoyCore})),__webpack_require__.d(__webpack_exports__,"latest_rpc_version",(function(){return latest_rpc_version})),__webpack_require__.d(__webpack_exports__,"loadImJoyRPC",(function(){return loadImJoyRPC}));var _getParams=function(e){var r={},o=document.createElement("a");o.href=e;for(var i=o.search.substring(1).split("&"),n=0;n<i.length;n++){var t=i[n].split("=");r[t[0]]=decodeURIComponent(t[1])}return r};function loadImJoyCore(config){return config=config||{},new Promise(async(resolve,reject)=>{try{var baseUrl=config.base_url;if(!baseUrl){const e=config.version||"latest";baseUrl=`https://cdn.jsdelivr.net/npm/imjoy-core@${e}/dist/`}if(delete window.imjoyCore,config.debug?await _injectScript(baseUrl+"imjoy-core.js"):await _injectScript(baseUrl+"imjoy-core.min.js"),window.imjoyCore){const e=window.imjoyCore;delete window.imjoyCore,resolve(e)}else"function"==typeof define&&__webpack_require__(13)?eval("require")(["imjoyCore"],resolve):reject("Failed to import imjoy-core.")}catch(e){reject(e)}})}const _rpc_registry={},latest_rpc_version="0.2.10",_rpc_api_versions={"0.2.0":{from:"0.1.10",to:"0.1.17",skips:[]},"0.2.1":{from:"0.1.18",to:"0.2.5",skips:[]},"0.2.2":{from:"0.2.6",to:"0.2.6",skips:[]},"0.2.3":{from:"0.2.7",to:latest_rpc_version,skips:["0.2.9"]}};function findRPCVersionByAPIVersion(e,r){if(!e||!e.includes("."))return;let o=Object.keys(_rpc_registry);if(_rpc_api_versions[e]){if(o.length<=0||r)return _rpc_api_versions[e].to;i=(e,r)=>e.map(e=>e.replace(/\d+/g,e=>+e+1e5*r)),o=i(i(o,1).sort(),-1);for(let r of o.reverse())if(_rpc_registry[r].API_VERSION===e)return r;return _rpc_api_versions[e].to}return null;var i}function loadImJoyRPC(config){return config=config||{},new Promise((resolve,reject)=>{var baseUrl=config.base_url;let version=config.version;if(!baseUrl)if(config.version)baseUrl=`https://cdn.jsdelivr.net/npm/imjoy-rpc@${config.version}/dist/`;else if(config.api_version){if(version=findRPCVersionByAPIVersion(config.api_version,!0),!version)return void reject(Error(`Cannot find a version of imjoy-rpc that supports api v${config.api_version}`));baseUrl=`https://cdn.jsdelivr.net/npm/imjoy-rpc@${version}/dist/`}else baseUrl="https://cdn.jsdelivr.net/npm/imjoy-rpc@latest/dist/",version="latest",console.info(`Using imjoy-rpc library from ${baseUrl}.`);if(version&&_rpc_registry[version])return console.info(`Using cached imjoy-rpc library v${version}.`),void resolve(_rpc_registry[version]);let rpc_url=baseUrl+"imjoy-rpc.min.js";function checkAndCacheLib(e){if(version&&"latest"!==version&&version!==e.VERSION)throw new Error(`imjoy-rpc version mismatch ${version} != ${e.VERSION}`);if(config.api_version&&config.api_version!==e.API_VERSION)throw new Error(`imjoy-rpc api version mismatch ${config.api_version} != ${e.API_VERSION}`);_rpc_registry[e.VERSION]=e}config.debug&&(rpc_url=baseUrl+"imjoy-rpc.js"),delete window.imjoyRPC,_injectScript(rpc_url).then(()=>{if(window.imjoyRPC){const e=window.imjoyRPC;delete window.imjoyRPC;try{checkAndCacheLib(e),resolve(e)}catch(e){reject(e)}}else{if("function"!=typeof define||!__webpack_require__(13))return void reject("Failed to import imjoy-rpc.");eval("require")(["imjoyRPC"],e=>{try{checkAndCacheLib(e),resolve(e)}catch(e){reject(e)}})}}).catch(reject)})}async function loadImJoyRPCByQueryString(){const e=_getParams(window.location);return await loadImJoyRPC(e)}window.loadImJoyRPCByQueryString=loadImJoyRPCByQueryString,window.loadImJoyRPC=loadImJoyRPC,window.loadImJoyCore=loadImJoyCore}})}));
//# sourceMappingURL=imjoy-loader.min.js.map