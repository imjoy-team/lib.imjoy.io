!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("imjoyLoader",[],e):"object"==typeof exports?exports.imjoyLoader=e():n.imjoyLoader=e()}(window,(function(){return function(n){var e={};function o(i){if(e[i])return e[i].exports;var t=e[i]={i:i,l:!1,exports:{}};return n[i].call(t.exports,t,t.exports,o),t.l=!0,t.exports}return o.m=n,o.c=e,o.d=function(n,e,i){o.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:i})},o.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},o.t=function(n,e){if(1&e&&(n=o(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var t in n)o.d(i,t,function(e){return n[e]}.bind(null,t));return i},o.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return o.d(e,"a",e),e},o.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},o.p="",o(o.s=21)}([,,,,,function(n,e,o){"use strict";o.d(e,"a",(function(){return w})),o.d(e,"b",(function(){return p}));var i=o(22),t=o.n(i),r=o(23),s=o.n(r),a=o(24),l=o.n(a),d=o(25),c=o.n(d);function w(n){return new Promise((e,o)=>{const i=document.createElement("script");i.src=n,i.addEventListener("load",e),i.addEventListener("error",()=>{document.head.removeChild(i),o("Error loading script: "+n)}),i.addEventListener("abort",()=>o("Script loading aborted.")),document.head.appendChild(i)})}function m(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+n+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}async function p(n){let e;await w("https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.min.js"),await w("https://imjoy-team.github.io/vue-js-modal/index.js"),await w("https://imjoy-team.github.io/vue-js-modal/styles.css");const o={showDialog:(n,e,o)=>((o=o||{}).dialog=!0,i.pm.createWindow(n,e,o)),createWindow:(e,o,t)=>(t=t||{},n.window_manager_container||(t.dialog=!0),i.pm.createWindow(e,o,t)),showSnackbar(n,o,i){e.showSnackbar(o,i)},showMessage(n,o){e.showSnackbar(o,5)},showStatus(n,o){e.showSnackbar(o,5)},showProgress(n,o){(o=o||0)<1&&(o*=100),e.progress=o,e.$forceUpdate()}};if((n=n||{}).imjoy_api)for(let e of Object.keys(n.imjoy_api))o[e]=n.imjoy_api[e];const i=new((await loadImJoyCore(n)).ImJoy)({imjoy_api:o});let r,a,d;if(await i.start(n),console.log("ImJoy Core started successfully!"),Vue.use(window["vue-js-modal"].default),n.main_container?r="string"==typeof n.main_container?document.getElementById(n.main_container):n.main_container:(r=document.createElement("div"),document.body.appendChild(r)),r.style.visibility="hidden",r.innerHTML=s.a,document.head.insertAdjacentHTML("beforeend",`<style>${t.a}</style>`),n.window_manager_container){let e;e="string"==typeof n.window_manager_container?document.getElementById(n.window_manager_container):n.window_manager_container,e.innerHTML=c.a,a=new Vue({el:e,data:{windowStyle:n.window_style||{},showEmpty:n.show_empty_window||!1,showWindowTitle:n.show_window_title||!1,windows:[],activeWindow:null}})}if(n.menu_container){let e;e="string"==typeof n.menu_container?document.getElementById(n.menu_container):n.menu_container,e.innerHTML=l.a,e.style.minHeight="30px",d=new Vue({el:e,data:{menuPos:n.menu_pos||"right",menuStyle:n.menu_style||{},activeWindow:null,closeWindow:null,extraMenuItems:[],loadedPlugins:[],allWindows:[]},mounted(){this.menuStyle=this.menuStyle||{},this.menuStyle.float="left"===this.menuPos?"left":"right"}})}return e=new Vue({el:r,data:{dialogWindows:[],selectedDialogWindow:null,selectedWindowsStack:[],selectedRegularWindow:null,fullscreen:!1,loading:!1,snackBarContent:!1,progress:0,loadedPlugins:[],allWindows:[],extraMenuItems:[],showProgressBar:n.show_progress_bar,showLoader:n.show_loader,showWindows:n.show_windows},mounted(){this.$el.style.visibility="visible",i.event_bus.on("close_window",n=>{this.closeWindow(n),this.$forceUpdate()}),i.event_bus.on("add_window",n=>{this.allWindows.push(n),this.addWindow(n)}),this.imjoy=i,n.process_url_query&&this.processURLQuery(),d&&(d.closeWindow=n=>{this.closeWindow(n)})},computed:{regularWindows:function(){return this.allWindows.filter(n=>!this.dialogWindows.includes(n))}},watch:{regularWindows:function(n){a&&(a.windows=n,a.$forceUpdate())},selectedRegularWindow:function(n){a&&(a.activeWindow=n,a.$forceUpdate()),d&&(d.activeWindow=n,d.$forceUpdate())},extraMenuItems:function(n){d&&(d.extraMenuItems=n,d.$forceUpdate())},allWindows:function(n){d&&(d.allWindows=n,d.$forceUpdate())},loadedPlugins:function(n){d&&(d.loadedPlugins=n,d.$forceUpdate())}},methods:{processURLQuery(){const n=m("token")||m("t"),e=m("engine")||m("e"),o=m("plugin")||m("p");e&&this.setupPluginEngine(e,n),o&&this.loadPlugin(o).then(async n=>{let e={};n.config.ui&&n.config.ui.indexOf("{")>-1&&(e=await i.pm.imjoy_api.showDialog(n,n.config)),await n.api.run({config:e,data:{}})})},async setupPluginEngine(n,e){try{console.log("Loading Jupyter-Engine-Manager from Gist..."),await i.pm.reloadPluginRecursively({uri:"https://imjoy-team.github.io/jupyter-engine-manager/Jupyter-Engine-Manager.imjoy.html"}),console.log("Jupyter-Engine-Manager loaded.");const o=i.em.getFactory("Jupyter-Engine");await o.addEngine({url:n,token:e}),console.log("plugin engine added:",n)}catch(n){console.error(n),alert(`Failed to connect to the engine: ${n}`)}},async loadPlugin(n){try{this.loading=!0;const e=await i.pm.reloadPluginRecursively({uri:n});return this.loadedPlugins.push(e),this.showSnackbar(`Plugin ${e.name} successfully loaded.`),e}finally{this.loading=!1}},addMenuItem(n){this.extraMenuItems.push(n),this.$forceUpdate()},removeMenuItem(n){const e=this.extraMenuItems.filter(e=>e.label===n)[0],o=this.extraMenuItems.indexOf(e);o>=0&&this.extraMenuItems.splice(o,1)},showSnackbar(n,e){e=e||3,this.snackBarContent=n,this.$forceUpdate(),setTimeout(()=>{this.snackBarContent=null,this.$forceUpdate()},1e3*e)},addWindow(n){if(!document.getElementById(n.window_id)){if(!n.dialog)return this.selectedRegularWindow=n,void(n.api.show=n.show=()=>{this.selectedRegularWindow=n,this.$forceUpdate(),i.wm.selectWindow(n),n.api.emit("show")});this.dialogWindows.push(n),this.selectedDialogWindow&&this.selectedWindowsStack.push(this.selectedDialogWindow),this.selectedDialogWindow=n,n.fullscreen||n.standalone?this.fullscreen=!0:this.fullscreen=!1,this.$modal.show("window-modal-dialog"),this.$forceUpdate(),n.api.show=n.show=()=>{this.selectedDialogWindow=n,this.$modal.show("window-modal-dialog"),i.wm.selectWindow(n),n.api.emit("show")},n.api.hide=n.hide=()=>{this.selectedDialogWindow===n&&this.$modal.hide("window-modal-dialog"),n.api.emit("hide")},setTimeout(()=>{try{n.show()}catch(n){console.error(n)}},500)}},showWindow(n){n.fullscreen||n.standalone?this.fullscreen=!0:this.fullscreen=!1,n&&(this.selectedDialogWindow=n),this.$modal.show("window-modal-dialog")},closeWindow(n){this.$modal.hide("window-modal-dialog");let e=this.dialogWindows.indexOf(n);e>=0&&this.dialogWindows.splice(e,1),e=this.allWindows.indexOf(n),e>=0&&this.allWindows.splice(e,1),n===this.selectedDialogWindow&&(this.selectedDialogWindow=this.selectedWindowsStack.pop()),n===this.selectedRegularWindow&&(this.regularWindows.length>0?this.selectedRegularWindow=this.regularWindows[this.regularWindows.length-1]||null:this.selectedRegularWindow=null),this.$forceUpdate()},minimizeWindow(){this.$modal.hide("window-modal-dialog")},maximizeWindow(){this.fullscreen=!this.fullscreen}}}),e}},,,,,,function(n){n.exports=JSON.parse('{"b":"0.13.61","a":{"ajv":"^6.9.1","axios":"^0.18.1","dompurify":"^2.0.8","file-saver":"^1.3.3","imjoy-rpc":"^0.2.31","js-yaml":"^3.13.1","lodash":"^4.17.15","lz-string":"^1.4.4","minibus":"^3.1.0","pouchdb-browser":"^7.0.0","socket.io-client":"^2.3.0","spark-md5":"^3.0.0"}}')},,,,,function(n,e){(function(e){n.exports=e}).call(this,{})},,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"loadImJoyCore",(function(){return loadImJoyCore})),__webpack_require__.d(__webpack_exports__,"latest_rpc_version",(function(){return latest_rpc_version})),__webpack_require__.d(__webpack_exports__,"loadImJoyRPC",(function(){return loadImJoyRPC}));var _package_json__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(11),_package_json__WEBPACK_IMPORTED_MODULE_0___namespace=__webpack_require__.t(11,1),_imjoyBasicApp_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5),_getParams=function(n){var e={},o=document.createElement("a");o.href=n;for(var i=o.search.substring(1).split("&"),t=0;t<i.length;t++){var r=i[t].split("=");e[r[0]]=decodeURIComponent(r[1])}return e};function loadImJoyCore(config){return config=config||{},new Promise(async(resolve,reject)=>{try{var baseUrl=config.base_url;if(!baseUrl){const n=config.version||"latest";baseUrl=`https://cdn.jsdelivr.net/npm/imjoy-core@${n}/dist/`}if(delete window.imjoyCore,config.debug?await Object(_imjoyBasicApp_js__WEBPACK_IMPORTED_MODULE_1__.a)(baseUrl+"imjoy-core.js"):await Object(_imjoyBasicApp_js__WEBPACK_IMPORTED_MODULE_1__.a)(baseUrl+"imjoy-core.min.js"),window.imjoyCore){const n=window.imjoyCore;delete window.imjoyCore,resolve(n)}else"function"==typeof define&&__webpack_require__(16)?eval("require")(["imjoyCore"],resolve):reject("Failed to import imjoy-core.")}catch(n){reject(n)}})}const _rpc_registry={},latest_rpc_version=_package_json__WEBPACK_IMPORTED_MODULE_0__.a["imjoy-rpc"].replace(/[^\d.-]/g,""),_rpc_api_versions={"0.2.0":{from:"0.1.10",to:"0.1.17",skips:[]},"0.2.1":{from:"0.1.18",to:"0.2.5",skips:[]},"0.2.2":{from:"0.2.6",to:"0.2.6",skips:[]},"0.2.3":{from:"0.2.7",to:latest_rpc_version,skips:["0.2.9","0.2.15","0.2.16","0.2.18","0.2.23","0.2.24","0.2.25"]}};function findRPCVersionByAPIVersion(n,e){if(!n||!n.includes("."))return;let o=Object.keys(_rpc_registry);if(_rpc_api_versions[n]){if(o.length<=0||e)return _rpc_api_versions[n].to;i=(n,e)=>n.map(n=>n.replace(/\d+/g,n=>+n+1e5*e)),o=i(i(o,1).sort(),-1);for(let e of o.reverse())if(_rpc_registry[e].API_VERSION===n)return e;return _rpc_api_versions[n].to}return null;var i}function loadImJoyRPC(config){return config=config||{},new Promise((resolve,reject)=>{var baseUrl=config.base_url;let version=config.version;if(!baseUrl)if(config.version)baseUrl=`https://cdn.jsdelivr.net/npm/imjoy-rpc@${config.version}/dist/`;else if(config.api_version){if(version=findRPCVersionByAPIVersion(config.api_version,!0),!version)return void reject(Error(`Cannot find a version of imjoy-rpc that supports api v${config.api_version}`));baseUrl=`https://cdn.jsdelivr.net/npm/imjoy-rpc@${version}/dist/`}else baseUrl="https://cdn.jsdelivr.net/npm/imjoy-rpc@latest/dist/",version="latest",console.info(`Using imjoy-rpc library from ${baseUrl}.`);if(version&&_rpc_registry[version])return console.info(`Using cached imjoy-rpc library v${version}.`),void resolve(_rpc_registry[version]);let rpc_url=baseUrl+"imjoy-rpc.min.js";function checkAndCacheLib(n){if(version&&"latest"!==version&&version!==n.VERSION)throw new Error(`imjoy-rpc version mismatch ${version} != ${n.VERSION}`);if(config.api_version&&config.api_version!==n.API_VERSION)throw new Error(`imjoy-rpc api version mismatch ${config.api_version} != ${n.API_VERSION}`);_rpc_registry[n.VERSION]=n}config.debug&&(rpc_url=baseUrl+"imjoy-rpc.js"),delete window.imjoyRPC,Object(_imjoyBasicApp_js__WEBPACK_IMPORTED_MODULE_1__.a)(rpc_url).then(()=>{if(window.imjoyRPC){const n=window.imjoyRPC;delete window.imjoyRPC;try{checkAndCacheLib(n),resolve(n)}catch(n){reject(n)}}else{if("function"!=typeof define||!__webpack_require__(16))return void reject("Failed to import imjoy-rpc.");eval("require")(["imjoyRPC"],n=>{try{checkAndCacheLib(n),resolve(n)}catch(n){reject(n)}})}}).catch(reject)})}async function loadImJoyRPCByQueryString(){const n=_getParams(window.location);return await loadImJoyRPC(n)}window.loadImJoyRPCByQueryString=loadImJoyRPCByQueryString,window.loadImJoyRPC=loadImJoyRPC,window.loadImJoyCore=loadImJoyCore,window.loadImJoyBasicApp=_imjoyBasicApp_js__WEBPACK_IMPORTED_MODULE_1__.b},function(n,e){n.exports=".vm--modal {\n  max-height: 100% !important;\n  max-width: 100% !important;\n}\n\n.imjoy-inline-window {\n  width: 100%;\n  height: 600px;\n}\n\n.imjoy-progress-border > div {\n  background-color: #448aff;\n  height: 3px;\n}\n\n.imjoy-progress-border {\n  top: 0;\n  left: 0;\n  position: absolute;\n  width: 100%;\n  height: 3px;\n}\n\n.imjoy-noselect {\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\nbody {\n  margin: 0px;\n}\n.imjoy-dialog-control {\n  height: 19px;\n  border: 0px;\n  font-size: 1rem;\n  position: absolute;\n  color: white;\n  top: 1px;\n}\n\n.imjoy-dialog-control:focus {\n  outline: none;\n}\n\n.imjoy-loader {\n  position: fixed;\n  top: 40%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  transform: -webkit-translate(-50%, -50%);\n  transform: -moz-translate(-50%, -50%);\n  transform: -ms-translate(-50%, -50%);\n  border: 10px solid #f3f3f3;\n  /* Light grey */\n  border-top: 10px solid #448aff;\n  /* Blue */\n  border-radius: 50%;\n  width: 40px;\n  height: 40px;\n  animation: spin 2s linear infinite;\n}\n\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n/* The snackbar - position it at the bottom and in the middle of the screen */\n.imjoy-snackbar {\n  font-family: Arial, Helvetica, sans-serif;\n  visibility: hidden;\n  /* Hidden by default. Visible on click */\n  min-width: 250px;\n  /* Set a default minimum width */\n  background-color: #333333c2;\n  /* Black background color */\n  color: #fff;\n  /* White text color */\n  text-align: center;\n  /* Centered text */\n  border-radius: 5px;\n  /* Rounded borders */\n  padding: 16px;\n  /* Padding */\n  position: fixed;\n  /* Sit on top of the screen */\n  z-index: 9999;\n  /* Add a z-index if needed */\n  left: 50%;\n  /* Center the snackbar */\n  transform: translate(-50%, 0);\n  bottom: 20px;\n  /* 20px from the bottom */\n}\n\n.imjoy-window-title-bar {\n  cursor: move;\n  background-color: #448aff;\n  color: white;\n  text-align: center;\n  height: 20px;\n}\n\n.imjoy-window-title {\n  text-align: center;\n  font-family: Arial, Helvetica, sans-serif;\n  font-size: small;\n  line-height: 20px;\n  margin: 0px;\n}\n\n/* Show the snackbar when clicking on a button (class added with JavaScript) */\n.imjoy-snackbar.show-snackbar {\n  visibility: visible;\n  /* Show the snackbar */\n  /* Add animation: Take 0.5 seconds to fade in and out the snackbar.\n  However, delay the fade out process for 2.5 seconds */\n  -webkit-animation: imjoy-fadein 0.5s;\n  animation: imjoy-fadein 0.5s;\n}\n\n/* Animations to fade the snackbar in and out */\n@-webkit-keyframes imjoy-fadein {\n  from {\n    bottom: 0;\n    opacity: 0;\n  }\n\n  to {\n    bottom: 30px;\n    opacity: 1;\n  }\n}\n\n@keyframes imjoy-fadein {\n  from {\n    bottom: 0;\n    opacity: 0;\n  }\n\n  to {\n    bottom: 30px;\n    opacity: 1;\n  }\n}\n\n.dropdown-btn {\n  padding: 4px;\n  font-size: 16px;\n  border: none;\n  cursor: pointer;\n}\n\n.dropdown {\n  position: relative;\n  display: inline-block;\n}\n\n.dropdown-content {\n  display: none;\n  position: absolute;\n  right: 0;\n  background-color: #f9f9f9;\n  min-width: 200px;\n  box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);\n  z-index: 1;\n}\n\n.dropdown-content a {\n  font-family: Arial, Helvetica, sans-serif;\n  color: black;\n  padding: 6px 10px;\n  text-decoration: none;\n  display: block;\n}\n\n.dropdown-content a:hover {\n  background-color: #f1f1f1;\n}\n\n.dropdown:hover .dropdown-content {\n  display: block;\n}\n\n.dropdown:hover .dropbtn {\n  background-color: #3e8e41;\n}\n\n.imjoy-window-container {\n  width: 100%;\n  height: 100%;\n}\n\n.imjoy-windows {\n  position: relative;\n  min-height: 100px;\n  height: calc(100% - 30px);\n}\n"},function(n,e){n.exports='<div v-if="showLoader" class="imjoy-loader" v-show="loading"></div>\n<div v-if="showProgressBar" class="imjoy-progress-border" v-show="progress">\n  <div :style="{width: progress+\'%\'}"></div>\n</div>\n<div\n  v-show="snackBarContent"\n  :class="{\'show-snackbar\': snackBarContent}"\n  class="imjoy-snackbar"\n>\n  {{snackBarContent}}\n</div>\n<modal\n  name="window-modal-dialog"\n  height="500px"\n  style="max-height: 100%; max-width: 100%"\n  :fullscreen="fullscreen"\n  :resizable="true"\n  draggable=".imjoy-drag-handle"\n  :scrollable="true"\n>\n  <div\n    v-if="selectedDialogWindow"\n    @dblclick="maximizeWindow()"\n    class="imjoy-drag-handle imjoy-window-title-bar"\n  >\n    <span class="imjoy-noselect imjoy-window-title"\n      >{{ selectedDialogWindow.name}}</span\n    >\n    <button\n      @click="closeWindow(selectedDialogWindow)"\n      class="imjoy-noselect imjoy-dialog-control"\n      style="background:#ff0000c4;left:1px;"\n    >\n      x\n    </button>\n    <button\n      @click="minimizeWindow()"\n      class="imjoy-noselect imjoy-dialog-control"\n      style="background:#00cdff61;left:25px;"\n    >\n      -\n    </button>\n    <button\n      @click="maximizeWindow()"\n      class="imjoy-noselect imjoy-dialog-control"\n      style="background:#00cdff61;left:45px;"\n    >\n      {{fullscreen?\'=\': \'+\'}}\n    </button>\n  </div>\n  <template v-for="wdialog in dialogWindows">\n    <div\n      :key="wdialog.window_id"\n      v-show="wdialog === selectedDialogWindow"\n      style="height: calc(100% - 18px);"\n    >\n      <div :id="wdialog.window_id" style="width: 100%;height: 100%;"></div>\n    </div>\n  </template>\n</modal>\n'},function(n,e){n.exports='<div class="dropdown" :style="menuStyle">\n  <a class="dropdown-btn"\n    ><img\n      style="width:24px;"\n      src="https://imjoy.io/static/img/imjoy-icon.svg"\n    />\n  </a>\n  <div class="dropdown-content" :style="{left: menuPos===\'left\'? 0: null}">\n    <a\n      href="#"\n      v-for="item in extraMenuItems"\n      :key="item.label"\n      @click="item.callback()"\n      >{{item.label}}</a\n    >\n    <hr\n      style="color: #80808073;"\n      v-show="extraMenuItems.length>0 && loadedPlugins.length>0"\n    />\n    <a href="#" v-for="p in loadedPlugins" :key="p.id" @click="p.api.run()"\n      >🧩 {{p.name}}</a\n    >\n    <hr\n      style="color: #80808073;"\n      v-show="allWindows.length>0 && loadedPlugins.length>0"\n    />\n    <a\n      href="#"\n      v-for="w in allWindows"\n      :style="{\'background-color\': activeWindow===w?\'#adcafb78\':\'\', \'font-weight\': activeWindow===w? 600:300}"\n      :key="w.id"\n      @click="w.api.show()"\n      >🔳 {{w.name}}</a\n    >\n    <a href="#" v-if="activeWindow" @click="closeWindow(activeWindow)"\n      >❌ Close Window</a\n    >\n  </div>\n</div>\n'},function(n,e){n.exports='<div>\n  <div\n    v-for="w in windows"\n    v-show="w === activeWindow"\n    :key="w.id"\n    class="imjoy-windows"\n    :style="windowStyle"\n  >\n    <div\n      v-if="showWindowTitle"\n      style="text-align: center;height:20px;margin-top: 5px; "\n    >\n      <span style="font-size:1rem;font-family: Arial, Helvetica, sans-serif;"\n        >{{ w.name }}</span\n      >\n    </div>\n    <div :id="w.window_id" class="imjoy-window-container"></div>\n  </div>\n  <div\n    v-if="showEmpty && (!activeWindow || windows.length <= 0)"\n    class="imjoy-windows"\n    :style="windowStyle"\n  >\n    <img\n      style="width:80px; position:absolute; left:50%; top: 50%; transform: translate(-50%, -50%);"\n      src="https://imjoy.io/static/img/imjoy-icon.svg"\n    />\n  </div>\n</div>\n'}])}));
//# sourceMappingURL=imjoy-loader.min.js.map